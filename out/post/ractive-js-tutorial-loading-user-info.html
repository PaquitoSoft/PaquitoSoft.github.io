<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>Ractive.js tutorial - Loading user info (4 of 6)</title><meta name="date" content="2015-08-01T19:08:30.642Z"/><meta name="keywords" content="tutorial, javascript, ractive, ractivejs"/><meta name="next-head-count" content="5"/><link rel="preload" href="/_next/static/css/fca08b764e01d142.css" as="style"/><link rel="stylesheet" href="/_next/static/css/fca08b764e01d142.css" data-n-g=""/><link rel="preload" href="/_next/static/css/4727cb7922ba92a1.css" as="style"/><link rel="stylesheet" href="/_next/static/css/4727cb7922ba92a1.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-f6f8e789435065da.js" defer=""></script><script src="/_next/static/chunks/framework-91d7f78b5b4003c8.js" defer=""></script><script src="/_next/static/chunks/main-59f1ed9830ced99b.js" defer=""></script><script src="/_next/static/chunks/pages/_app-12e47b2d3cbfdb5e.js" defer=""></script><script src="/_next/static/chunks/834-1fce47b417d9f245.js" defer=""></script><script src="/_next/static/chunks/pages/post/%5Bslug%5D-86b3e650bf853aa5.js" defer=""></script><script src="/_next/static/Dhh1eIxwrKki7CqZexiwV/_buildManifest.js" defer=""></script><script src="/_next/static/Dhh1eIxwrKki7CqZexiwV/_ssgManifest.js" defer=""></script><script src="/_next/static/Dhh1eIxwrKki7CqZexiwV/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><header class="header_header__U_Kza"><a class="title-link_titleLink__5zxWi header_title__DvyTk" href="/"><h2>Paquitosoft&#x27;s corner</h2></a></header><main class="container main-content"><div class="grid"><section><div><article class="card_card__43_8m"><header class="card_title__ITk4U"><h3>Ractive.js tutorial - Loading user info (4 of 6)</h3></header><div><span><p>(<em>Previous step</em>: <a href="/post/ractive-js-tutorial-routing">Routing</a>)</p>
<p>Rigth now our page shows nothing but some labels.
The next step is to allow our users to search for a GitHub user and, if it's found, show his info in the specific page.</p>
<p>We will be requesting data to the <a href="https://developer.github.com/v3/">GitHub REST API</a>.
These are the endpoints we'll be hitting:</p>
<ul>
<li>https://api.github.com/users/{username}: Get user main info</li>
<li>https://api.github.com/users/{username}/repos: Get user's repositories data</li>
</ul>
<h2>Polyfills</h2>
<p>To implement third party integration, we will be usign two new <em>ES2015</em> APIs which are not already arrived to all browsers, so we need to include some polyfills in our application for them: <a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API">fetch</a> and <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a>.</p>
<p>We will need to update our <strong>webpack</strong> configuration to include in our JS bundle these polyfills.</p>
<p>First, we need to install the polyfills and a couple of <em>webpack</em> plugins:</p>
<pre><code>$ npm install es6-promise whatwg-fetch --save
$ npm install imports-loader exports-loader --save-dev
</code></pre>
<p>Now, we update the <em>webpack</em> configuration file:</p>
<pre><code class="language-javascript">var webpack = require('webpack');

module.exports = {
	entry: './app/js/app.js',
	output: {
		filename: 'app/js/dist/bundle.js'
	},
	module: {
		loaders: [
			{
				test: /\\.js$/,
				exclude: /(node_modules|bower_components)/,
				loader: 'babel'
			},
			{
				test: /\\.html$/,
				loader: 'raw'
			}
		]
	},
	// This is to load polyfills (http://mts.io/2015/04/08/webpack-shims-polyfills/)
	plugins: [
		new webpack.ProvidePlugin({
			fetch: 'imports?this=&gt;global!exports?global.fetch!whatwg-fetch',
			'es6-promise': 'es6-promise'
		})
	]
};
</code></pre>
<h2>Search user component</h2>
<p>Before we make any request, we must update our <em>SearchUser</em> component to handle username submission and navigate to user page.
Just update its <em>searchUser</em> <a href="http://docs.ractivejs.org/latest/proxy-events">proxy event</a> to get the username introduced by our user and try to navigate to the corresponding URL.
<strong><em>root-folder</em>/app/js/components/layout/search-user.js</strong></p>
<pre><code class="language-javascript">import Ractive from 'ractive';
import Template from '../../../views/layout/search-user.html';
import * as router from '../../plugins/router';

var SearchGithub = Ractive.extend({
	isolated: true,
	template: Template,

	oninit() {
		this.on('searchUser', (rEvent) =&gt; {
			rEvent.original.preventDefault();
			router.navTo(`/user/${rEvent.context.query}`);
			this.set('query', '');
		});
	},

	data: {
			query: ''
	}
});

export default SearchGithub;
</code></pre>
<p>We've just imported the router plugin and configured the <em>serachUser</em> handler to call plugin's navigation function passing the URL we want to visit (note the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/template_strings">string interpolation</a> to build the URL).</p>
<p>Now, when we type a username and submit the form, our router will call our '/user/:username' URL handler (defined in our <em>/app/js/config/routes.js</em> file).
We need to update that handler to perform our action, in this case, load user's info and repos data.</p>
<h2>Ajax plugin</h2>
<p>Instead of implement all the logic to fetch user related data in the route handler, we'll be using several objects to separete concerns.
In one hand, we'll have a plugin to deal with <em>AJAX</em> request (we'll use the new, in progress, <a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API">fetch API</a>). On the other hand we'll have a model object to represent a user so it will have all the logic related with users operations.</p>
<p>Let's first create the ajax plugin:
<strong><em>root-folder</em>/app/js/plugins/ajax.js</strong></p>
<pre><code class="language-javascript">function checkResponseStatus(res) {
	if (res.status &lt; 400) {
		return res;
	} else {
		let error = new Error(res.statusText);
		error.statusCode = res.status;
		error.response = res;
		throw error;
	}
}

function parseJson(res) {
	return new Promise((resolve) =&gt; {
		res.json().then(data =&gt; {
			resolve({
				json: data,
				url: res.url
			});
		});
	});
}

export function getJson(url) {
	return fetch(url)
		.then(checkResponseStatus)
		.then(parseJson);
}
</code></pre>
<p>Ok, this file exports a <em>getJson</em> function which allows to fetch JSON data and return a JS object.</p>
<p>The <em>fetch</em> function returns a promise which will get a <a href="https://developer.mozilla.org/en-US/docs/Web/API/Response">Response</a> object as response.
We chain that promise with another one which checks the response status and another one to extract the data from the json response.
You must remember something very important when using <em>fetch</em> function: if the endpoint responds with an error (for instance, a 4XX or 5XX response status code), the <em>fetch</em> function will not invoke the <em>reject</em> part of the promise it creates. That's why we need to first check for the status code of the response, before parsing its body.
Personally, I don't like this behavior and I hope this could change before closing this API specification.</p>
<h2>User model</h2>
<p>Next, we create our user <em>model</em>, where we encapsulate users state and behavior.
<strong><em>root-folder</em>/app/js/models/user.js</strong></p>
<pre><code class="language-javascript">import * as ajax from '../plugins/ajax';

const GITHUB_BASE_URL = 'https://api.github.com';

class User {
	
	constructor(profile, repos, notes) {
		this.profile = profile;
		this.repos = repos;
		this.notes = notes || []; // Default parameters values are only valid for undefined ones
	}

	static findByName(username) {
		let userProfileUrl = `${GITHUB_BASE_URL}/users/${username}`,
			userReposUrl = `${GITHUB_BASE_URL}/users/${username}/repos`;

		let result = new Promise((resolve, reject) =&gt; {
				Promise.all([
					ajax.getJson(userProfileUrl),
				ajax.getJson(userReposUrl),
			])
			.then(values =&gt; {
					resolve(new User(values[0], values[1]));
			})
			.catch(reject);
		});

		return result;
	}
}

export default User;
</code></pre>
<h2>Route handling</h2>
<p>This is a <em>ES2015</em> class with its <em>constructor</em> function that gets invoked when we create a new instance and a <em>static</em> function which allows to call it without creating a new instance.
Since our <em>ajax</em> plugin uses the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API"><em>fetch</em></a> API and it returns promises, here we use the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/all">Promise.all</a> function which allows to group several promises and get notified when all of them have completed (<em>or when one of them has failed</em>).</p>
<p>Now we need to update our routing configuration so that when the user page URL gets requested, we use this user model object to fetch needed data.
<strong><em>root-folder</em>/app/js/config/routes.js</strong></p>
<pre><code class="language-javascript">'use strict';

import router from '../plugins/router';
import HomePage from '../components/home-page';
import UserPage from '../components/user-page';
import UserModel from '../models/user';

var routes = new Map();

routes.set('/', (context, next) =&gt; {
	next(null, HomePage);
});

routes.set('/user/:username', (context, next) =&gt; {
	UserModel.findByName(context.params.username)
	.then((user) =&gt; {
			next(null, UserPage, {
				user: user
		});
	})
	.catch((err) =&gt; {
			next(err);
	});
});

export default routes;
</code></pre>
<p>We get the username from the context parameter and use it to call the user model <em>findByName</em> function so we get user's instance model object.
We then call <em>next</em> so the control gets to the <em>App</em> instance, which updates the <em>componentName</em> (page to be shown) and the request data.
Just to remember...
<strong><em>root-folder</em>/app/js/app.js</strong></p>
<pre><code class="language-javascript">...
onNavigation(error, navigationContext) {
		console.log('APP::onNavigation# Navigating to:', navigationContext.pageName, 'with context:', navigationContext);

		if (error) {
			console.warn('App::onNavigation# Error navigating:', error);
		} else {
			this.set({
				req: {
					params: navigationContext.params,
					body: navigationContext.state
				},
				componentName: navigationContext.pageName
			});
		}
	}
...
</code></pre>
<p>Now we need to modify our user page component so, when the request data get updated, it updates its <em>user</em> data attribute so the presentation show the new data.
<strong><em>root-folder</em>/app/js/components/user-page.js</strong></p>
<pre><code class="language-javascript">import Ractive from 'ractive';
import Template from '../../views/user-page.html';
import UserProfile from './user/profile-section';
import Repos from './user/repos-section';
import Notes from './user/notes-section';

var UserPage = Ractive.components.UserPage = Ractive.extend({
	template: Template,
	components: {
		UserProfile: UserProfile,
		Repos: Repos,
		Notes: Notes
	},
	oninit() {
		this.observe('req', (request) =&gt; {
			this.set('user', request.body.user);
		});
	}
});
UserPage._name = 'UserPage';

export default UserPage;
</code></pre>
<p>When the page component is initialized, it begins observing for changes in the <em>req</em> data context attribute (which is handled by the <em>App</em> instance).
As we didn't set pages objects as isolated, they will get notified when that attribute gets updated.</p>
<p>If you try to search for a user right now, you won't see any data in your browser, but you won't see any error neither. This is because there's something missing.
Remember pages components are the only ones <em>non isolated</em>, so we need to pass the right user's data to its reusable components.
We need to update our user's page view:
<strong><em>root-folder</em>/app/views/user-page.html</strong></p>
<pre><code class="language-html">&lt;div class=&quot;row&quot;&gt;
	&lt;div class=&quot;col-md-4&quot;&gt;
		&lt;UserProfile profile=&quot;{{user.profile}}&quot; /&gt;
	&lt;/div&gt;
	&lt;div class=&quot;col-md-4&quot;&gt;
		&lt;Repos repos=&quot;{{user.repos}}&quot; /&gt;
	&lt;/div&gt;
	&lt;div class=&quot;col-md-4&quot;&gt;
		&lt;Notes /&gt;
	&lt;/div&gt;
&lt;/div&gt;
</code></pre>
<p>Now, if you load the app in your browser and search for a user, you must see his profile data and repos.
<img src="/content/images/2015/08/ractive-tutorial-08.png" alt=""></p>
<hr>
<p>You can check the source code in <a href="https://github.com/PaquitoSoft/notetaker-ractive">this GitHub repo</a>.</p>
<hr>
<p>Previous post: <a href="/post/ractive-js-tutorial-routing">Routing</a>
Next post: <a href="/post/ractive-js-tutorial-managing-users-notes">Managing user's notes</a></p>
<hr>
</span></div><footer class="card_footer__5rntJ"><div>Published: <!-- -->01/08/2015</div></footer></article></div></section><aside><article class="about-me_aboutMeContainer__tBCGw"><header class="about-me_title__My_yA">About me</header><div><img class="about-me_avatar__rCHR2" src="/images/gravatar.jpg" alt="Paquitosoft avatar" height="150" width="150"/></div><footer class="about-me_footer__Io_kX"><ul><li class="about-me_profileLink__b1Ipw"><a href="https://github.com/PaquitoSoft" target="_blank" rel="noreferrer"><svg class="" height="24" width="24" fill="inherit"><path d="M12,2A10,10 0 0,0 2,12C2,16.42 4.87,20.17 8.84,21.5C9.34,21.58 9.5,21.27 9.5,21C9.5,20.77 9.5,20.14 9.5,19.31C6.73,19.91 6.14,17.97 6.14,17.97C5.68,16.81 5.03,16.5 5.03,16.5C4.12,15.88 5.1,15.9 5.1,15.9C6.1,15.97 6.63,16.93 6.63,16.93C7.5,18.45 8.97,18 9.54,17.76C9.63,17.11 9.89,16.67 10.17,16.42C7.95,16.17 5.62,15.31 5.62,11.5C5.62,10.39 6,9.5 6.65,8.79C6.55,8.54 6.2,7.5 6.75,6.15C6.75,6.15 7.59,5.88 9.5,7.17C10.29,6.95 11.15,6.84 12,6.84C12.85,6.84 13.71,6.95 14.5,7.17C16.41,5.88 17.25,6.15 17.25,6.15C17.8,7.5 17.45,8.54 17.35,8.79C18,9.5 18.38,10.39 18.38,11.5C18.38,15.32 16.04,16.16 13.81,16.41C14.17,16.72 14.5,17.33 14.5,18.26C14.5,19.6 14.5,20.68 14.5,21C14.5,21.27 14.66,21.59 15.17,21.5C19.14,20.16 22,16.42 22,12A10,10 0 0,0 12,2Z"></path></svg></a></li><li class="about-me_profileLink__b1Ipw"><a href="https://twitter.com/telemaco82" target="_blank" rel="noreferrer"><svg class="" height="24" width="24" fill="inherit"><path d="M22.46,6C21.69,6.35 20.86,6.58 20,6.69C20.88,6.16 21.56,5.32 21.88,4.31C21.05,4.81 20.13,5.16 19.16,5.36C18.37,4.5 17.26,4 16,4C13.65,4 11.73,5.92 11.73,8.29C11.73,8.63 11.77,8.96 11.84,9.27C8.28,9.09 5.11,7.38 3,4.79C2.63,5.42 2.42,6.16 2.42,6.94C2.42,8.43 3.17,9.75 4.33,10.5C3.62,10.5 2.96,10.3 2.38,10C2.38,10 2.38,10 2.38,10.03C2.38,12.11 3.86,13.85 5.82,14.24C5.46,14.34 5.08,14.39 4.69,14.39C4.42,14.39 4.15,14.36 3.89,14.31C4.43,16 6,17.26 7.89,17.29C6.43,18.45 4.58,19.13 2.56,19.13C2.22,19.13 1.88,19.11 1.54,19.07C3.44,20.29 5.7,21 8.12,21C16,21 20.33,14.46 20.33,8.79C20.33,8.6 20.33,8.42 20.32,8.23C21.16,7.63 21.88,6.87 22.46,6Z"></path></svg></a></li><li class="about-me_profileLink__b1Ipw"><a href="hhtps://www.linkedin.com/in/carlos-martÃ­nez-cortizas-81763b2b" target="_blank" rel="noreferrer"><svg class="" height="24" width="24" fill="inherit"><path d="M19 3A2 2 0 0 1 21 5V19A2 2 0 0 1 19 21H5A2 2 0 0 1 3 19V5A2 2 0 0 1 5 3H19M18.5 18.5V13.2A3.26 3.26 0 0 0 15.24 9.94C14.39 9.94 13.4 10.46 12.92 11.24V10.13H10.13V18.5H12.92V13.57C12.92 12.8 13.54 12.17 14.31 12.17A1.4 1.4 0 0 1 15.71 13.57V18.5H18.5M6.88 8.56A1.68 1.68 0 0 0 8.56 6.88C8.56 5.95 7.81 5.19 6.88 5.19A1.69 1.69 0 0 0 5.19 6.88C5.19 7.81 5.95 8.56 6.88 8.56M8.27 18.5V10.13H5.5V18.5H8.27Z"></path></svg></a></li></ul></footer></article></aside></div></main><footer class="footer_footer__GaW5f">Developed using<a href="https://nextjs.org" target="_blank" rel="noreferrer">Next.js</a> and<a href="https://picocss.com/" target="_blank" rel="noreferrer">PicoCSS</a></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"slug":"ractive-js-tutorial-loading-user-info","title":"Ractive.js tutorial - Loading user info (4 of 6)","creationDate":"2015-08-01T19:08:30.642Z","keywords":"tutorial, javascript, ractive, ractivejs","status":"published","excerpt":"\u003cp\u003e(\u003cem\u003ePrevious step\u003c/em\u003e: \u003ca href=\"/post/ractive-js-tutorial-routing\"\u003eRouting\u003c/a\u003e)\u003c/p\u003e\n\u003cp\u003eRigth now our page shows nothing but some labels.\nThe next step is to allow our users to search for a GitHub user and, if it's found, show his info in the specific page.\u003c/p\u003e\n\u003cp\u003eWe will be requesting data to the \u003ca href=\"https://developer.github.com/v3/\"\u003eGitHub REST API\u003c/a\u003e.\nThese are the endpoints we'll be hitting:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ehttps://api.github.com/users/{username}: Get user main info\u003c/li\u003e\n\u003cli\u003ehttps://api.github.com/users/{username}/repos: Get user's repositories data\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003ePolyfills\u003c/h2\u003e\n\u003cp\u003eTo implement third party integration, we will be usign two new \u003cem\u003eES2015\u003c/em\u003e APIs which are not already arrived to all browsers, so we need to include some polyfills in our application for them: \u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API\"\u003efetch\u003c/a\u003e and \u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise\"\u003ePromise\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eWe will need to update our \u003cstrong\u003ewebpack\u003c/strong\u003e configuration to include in our JS bundle these polyfills.\u003c/p\u003e\n\u003cp\u003eFirst, we need to install the polyfills and a couple of \u003cem\u003ewebpack\u003c/em\u003e plugins:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e$ npm install es6-promise whatwg-fetch --save\n$ npm install imports-loader exports-loader --save-dev\n\u003c/code\u003e\u003c/pre\u003e\n","content":"\u003cp\u003e(\u003cem\u003ePrevious step\u003c/em\u003e: \u003ca href=\"/post/ractive-js-tutorial-routing\"\u003eRouting\u003c/a\u003e)\u003c/p\u003e\n\u003cp\u003eRigth now our page shows nothing but some labels.\nThe next step is to allow our users to search for a GitHub user and, if it's found, show his info in the specific page.\u003c/p\u003e\n\u003cp\u003eWe will be requesting data to the \u003ca href=\"https://developer.github.com/v3/\"\u003eGitHub REST API\u003c/a\u003e.\nThese are the endpoints we'll be hitting:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ehttps://api.github.com/users/{username}: Get user main info\u003c/li\u003e\n\u003cli\u003ehttps://api.github.com/users/{username}/repos: Get user's repositories data\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003ePolyfills\u003c/h2\u003e\n\u003cp\u003eTo implement third party integration, we will be usign two new \u003cem\u003eES2015\u003c/em\u003e APIs which are not already arrived to all browsers, so we need to include some polyfills in our application for them: \u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API\"\u003efetch\u003c/a\u003e and \u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise\"\u003ePromise\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eWe will need to update our \u003cstrong\u003ewebpack\u003c/strong\u003e configuration to include in our JS bundle these polyfills.\u003c/p\u003e\n\u003cp\u003eFirst, we need to install the polyfills and a couple of \u003cem\u003ewebpack\u003c/em\u003e plugins:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e$ npm install es6-promise whatwg-fetch --save\n$ npm install imports-loader exports-loader --save-dev\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eNow, we update the \u003cem\u003ewebpack\u003c/em\u003e configuration file:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-javascript\"\u003evar webpack = require('webpack');\n\nmodule.exports = {\n\tentry: './app/js/app.js',\n\toutput: {\n\t\tfilename: 'app/js/dist/bundle.js'\n\t},\n\tmodule: {\n\t\tloaders: [\n\t\t\t{\n\t\t\t\ttest: /\\\\.js$/,\n\t\t\t\texclude: /(node_modules|bower_components)/,\n\t\t\t\tloader: 'babel'\n\t\t\t},\n\t\t\t{\n\t\t\t\ttest: /\\\\.html$/,\n\t\t\t\tloader: 'raw'\n\t\t\t}\n\t\t]\n\t},\n\t// This is to load polyfills (http://mts.io/2015/04/08/webpack-shims-polyfills/)\n\tplugins: [\n\t\tnew webpack.ProvidePlugin({\n\t\t\tfetch: 'imports?this=\u0026gt;global!exports?global.fetch!whatwg-fetch',\n\t\t\t'es6-promise': 'es6-promise'\n\t\t})\n\t]\n};\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003eSearch user component\u003c/h2\u003e\n\u003cp\u003eBefore we make any request, we must update our \u003cem\u003eSearchUser\u003c/em\u003e component to handle username submission and navigate to user page.\nJust update its \u003cem\u003esearchUser\u003c/em\u003e \u003ca href=\"http://docs.ractivejs.org/latest/proxy-events\"\u003eproxy event\u003c/a\u003e to get the username introduced by our user and try to navigate to the corresponding URL.\n\u003cstrong\u003e\u003cem\u003eroot-folder\u003c/em\u003e/app/js/components/layout/search-user.js\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-javascript\"\u003eimport Ractive from 'ractive';\nimport Template from '../../../views/layout/search-user.html';\nimport * as router from '../../plugins/router';\n\nvar SearchGithub = Ractive.extend({\n\tisolated: true,\n\ttemplate: Template,\n\n\toninit() {\n\t\tthis.on('searchUser', (rEvent) =\u0026gt; {\n\t\t\trEvent.original.preventDefault();\n\t\t\trouter.navTo(`/user/${rEvent.context.query}`);\n\t\t\tthis.set('query', '');\n\t\t});\n\t},\n\n\tdata: {\n\t\t\tquery: ''\n\t}\n});\n\nexport default SearchGithub;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eWe've just imported the router plugin and configured the \u003cem\u003eserachUser\u003c/em\u003e handler to call plugin's navigation function passing the URL we want to visit (note the \u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/template_strings\"\u003estring interpolation\u003c/a\u003e to build the URL).\u003c/p\u003e\n\u003cp\u003eNow, when we type a username and submit the form, our router will call our '/user/:username' URL handler (defined in our \u003cem\u003e/app/js/config/routes.js\u003c/em\u003e file).\nWe need to update that handler to perform our action, in this case, load user's info and repos data.\u003c/p\u003e\n\u003ch2\u003eAjax plugin\u003c/h2\u003e\n\u003cp\u003eInstead of implement all the logic to fetch user related data in the route handler, we'll be using several objects to separete concerns.\nIn one hand, we'll have a plugin to deal with \u003cem\u003eAJAX\u003c/em\u003e request (we'll use the new, in progress, \u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API\"\u003efetch API\u003c/a\u003e). On the other hand we'll have a model object to represent a user so it will have all the logic related with users operations.\u003c/p\u003e\n\u003cp\u003eLet's first create the ajax plugin:\n\u003cstrong\u003e\u003cem\u003eroot-folder\u003c/em\u003e/app/js/plugins/ajax.js\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-javascript\"\u003efunction checkResponseStatus(res) {\n\tif (res.status \u0026lt; 400) {\n\t\treturn res;\n\t} else {\n\t\tlet error = new Error(res.statusText);\n\t\terror.statusCode = res.status;\n\t\terror.response = res;\n\t\tthrow error;\n\t}\n}\n\nfunction parseJson(res) {\n\treturn new Promise((resolve) =\u0026gt; {\n\t\tres.json().then(data =\u0026gt; {\n\t\t\tresolve({\n\t\t\t\tjson: data,\n\t\t\t\turl: res.url\n\t\t\t});\n\t\t});\n\t});\n}\n\nexport function getJson(url) {\n\treturn fetch(url)\n\t\t.then(checkResponseStatus)\n\t\t.then(parseJson);\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eOk, this file exports a \u003cem\u003egetJson\u003c/em\u003e function which allows to fetch JSON data and return a JS object.\u003c/p\u003e\n\u003cp\u003eThe \u003cem\u003efetch\u003c/em\u003e function returns a promise which will get a \u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/API/Response\"\u003eResponse\u003c/a\u003e object as response.\nWe chain that promise with another one which checks the response status and another one to extract the data from the json response.\nYou must remember something very important when using \u003cem\u003efetch\u003c/em\u003e function: if the endpoint responds with an error (for instance, a 4XX or 5XX response status code), the \u003cem\u003efetch\u003c/em\u003e function will not invoke the \u003cem\u003ereject\u003c/em\u003e part of the promise it creates. That's why we need to first check for the status code of the response, before parsing its body.\nPersonally, I don't like this behavior and I hope this could change before closing this API specification.\u003c/p\u003e\n\u003ch2\u003eUser model\u003c/h2\u003e\n\u003cp\u003eNext, we create our user \u003cem\u003emodel\u003c/em\u003e, where we encapsulate users state and behavior.\n\u003cstrong\u003e\u003cem\u003eroot-folder\u003c/em\u003e/app/js/models/user.js\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-javascript\"\u003eimport * as ajax from '../plugins/ajax';\n\nconst GITHUB_BASE_URL = 'https://api.github.com';\n\nclass User {\n\t\n\tconstructor(profile, repos, notes) {\n\t\tthis.profile = profile;\n\t\tthis.repos = repos;\n\t\tthis.notes = notes || []; // Default parameters values are only valid for undefined ones\n\t}\n\n\tstatic findByName(username) {\n\t\tlet userProfileUrl = `${GITHUB_BASE_URL}/users/${username}`,\n\t\t\tuserReposUrl = `${GITHUB_BASE_URL}/users/${username}/repos`;\n\n\t\tlet result = new Promise((resolve, reject) =\u0026gt; {\n\t\t\t\tPromise.all([\n\t\t\t\t\tajax.getJson(userProfileUrl),\n\t\t\t\tajax.getJson(userReposUrl),\n\t\t\t])\n\t\t\t.then(values =\u0026gt; {\n\t\t\t\t\tresolve(new User(values[0], values[1]));\n\t\t\t})\n\t\t\t.catch(reject);\n\t\t});\n\n\t\treturn result;\n\t}\n}\n\nexport default User;\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003eRoute handling\u003c/h2\u003e\n\u003cp\u003eThis is a \u003cem\u003eES2015\u003c/em\u003e class with its \u003cem\u003econstructor\u003c/em\u003e function that gets invoked when we create a new instance and a \u003cem\u003estatic\u003c/em\u003e function which allows to call it without creating a new instance.\nSince our \u003cem\u003eajax\u003c/em\u003e plugin uses the \u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API\"\u003e\u003cem\u003efetch\u003c/em\u003e\u003c/a\u003e API and it returns promises, here we use the \u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/all\"\u003ePromise.all\u003c/a\u003e function which allows to group several promises and get notified when all of them have completed (\u003cem\u003eor when one of them has failed\u003c/em\u003e).\u003c/p\u003e\n\u003cp\u003eNow we need to update our routing configuration so that when the user page URL gets requested, we use this user model object to fetch needed data.\n\u003cstrong\u003e\u003cem\u003eroot-folder\u003c/em\u003e/app/js/config/routes.js\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-javascript\"\u003e'use strict';\n\nimport router from '../plugins/router';\nimport HomePage from '../components/home-page';\nimport UserPage from '../components/user-page';\nimport UserModel from '../models/user';\n\nvar routes = new Map();\n\nroutes.set('/', (context, next) =\u0026gt; {\n\tnext(null, HomePage);\n});\n\nroutes.set('/user/:username', (context, next) =\u0026gt; {\n\tUserModel.findByName(context.params.username)\n\t.then((user) =\u0026gt; {\n\t\t\tnext(null, UserPage, {\n\t\t\t\tuser: user\n\t\t});\n\t})\n\t.catch((err) =\u0026gt; {\n\t\t\tnext(err);\n\t});\n});\n\nexport default routes;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eWe get the username from the context parameter and use it to call the user model \u003cem\u003efindByName\u003c/em\u003e function so we get user's instance model object.\nWe then call \u003cem\u003enext\u003c/em\u003e so the control gets to the \u003cem\u003eApp\u003c/em\u003e instance, which updates the \u003cem\u003ecomponentName\u003c/em\u003e (page to be shown) and the request data.\nJust to remember...\n\u003cstrong\u003e\u003cem\u003eroot-folder\u003c/em\u003e/app/js/app.js\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-javascript\"\u003e...\nonNavigation(error, navigationContext) {\n\t\tconsole.log('APP::onNavigation# Navigating to:', navigationContext.pageName, 'with context:', navigationContext);\n\n\t\tif (error) {\n\t\t\tconsole.warn('App::onNavigation# Error navigating:', error);\n\t\t} else {\n\t\t\tthis.set({\n\t\t\t\treq: {\n\t\t\t\t\tparams: navigationContext.params,\n\t\t\t\t\tbody: navigationContext.state\n\t\t\t\t},\n\t\t\t\tcomponentName: navigationContext.pageName\n\t\t\t});\n\t\t}\n\t}\n...\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eNow we need to modify our user page component so, when the request data get updated, it updates its \u003cem\u003euser\u003c/em\u003e data attribute so the presentation show the new data.\n\u003cstrong\u003e\u003cem\u003eroot-folder\u003c/em\u003e/app/js/components/user-page.js\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-javascript\"\u003eimport Ractive from 'ractive';\nimport Template from '../../views/user-page.html';\nimport UserProfile from './user/profile-section';\nimport Repos from './user/repos-section';\nimport Notes from './user/notes-section';\n\nvar UserPage = Ractive.components.UserPage = Ractive.extend({\n\ttemplate: Template,\n\tcomponents: {\n\t\tUserProfile: UserProfile,\n\t\tRepos: Repos,\n\t\tNotes: Notes\n\t},\n\toninit() {\n\t\tthis.observe('req', (request) =\u0026gt; {\n\t\t\tthis.set('user', request.body.user);\n\t\t});\n\t}\n});\nUserPage._name = 'UserPage';\n\nexport default UserPage;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eWhen the page component is initialized, it begins observing for changes in the \u003cem\u003ereq\u003c/em\u003e data context attribute (which is handled by the \u003cem\u003eApp\u003c/em\u003e instance).\nAs we didn't set pages objects as isolated, they will get notified when that attribute gets updated.\u003c/p\u003e\n\u003cp\u003eIf you try to search for a user right now, you won't see any data in your browser, but you won't see any error neither. This is because there's something missing.\nRemember pages components are the only ones \u003cem\u003enon isolated\u003c/em\u003e, so we need to pass the right user's data to its reusable components.\nWe need to update our user's page view:\n\u003cstrong\u003e\u003cem\u003eroot-folder\u003c/em\u003e/app/views/user-page.html\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-html\"\u003e\u0026lt;div class=\u0026quot;row\u0026quot;\u0026gt;\n\t\u0026lt;div class=\u0026quot;col-md-4\u0026quot;\u0026gt;\n\t\t\u0026lt;UserProfile profile=\u0026quot;{{user.profile}}\u0026quot; /\u0026gt;\n\t\u0026lt;/div\u0026gt;\n\t\u0026lt;div class=\u0026quot;col-md-4\u0026quot;\u0026gt;\n\t\t\u0026lt;Repos repos=\u0026quot;{{user.repos}}\u0026quot; /\u0026gt;\n\t\u0026lt;/div\u0026gt;\n\t\u0026lt;div class=\u0026quot;col-md-4\u0026quot;\u0026gt;\n\t\t\u0026lt;Notes /\u0026gt;\n\t\u0026lt;/div\u0026gt;\n\u0026lt;/div\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eNow, if you load the app in your browser and search for a user, you must see his profile data and repos.\n\u003cimg src=\"/content/images/2015/08/ractive-tutorial-08.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003chr\u003e\n\u003cp\u003eYou can check the source code in \u003ca href=\"https://github.com/PaquitoSoft/notetaker-ractive\"\u003ethis GitHub repo\u003c/a\u003e.\u003c/p\u003e\n\u003chr\u003e\n\u003cp\u003ePrevious post: \u003ca href=\"/post/ractive-js-tutorial-routing\"\u003eRouting\u003c/a\u003e\nNext post: \u003ca href=\"/post/ractive-js-tutorial-managing-users-notes\"\u003eManaging user's notes\u003c/a\u003e\u003c/p\u003e\n\u003chr\u003e\n"},"_superjson":{"values":{"post.creationDate":["Date"]}}},"__N_SSG":true},"page":"/post/[slug]","query":{"slug":"ractive-js-tutorial-loading-user-info"},"buildId":"Dhh1eIxwrKki7CqZexiwV","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>